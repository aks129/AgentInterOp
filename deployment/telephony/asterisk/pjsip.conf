; PJSIP Configuration for AgentInterOp Telephony
; This configures Asterisk to work with AWS Chime SIP trunking

; =============================================================================
; Transport Configuration
; =============================================================================

[transport-tls]
type=transport
protocol=tls
bind=0.0.0.0:5061
cert_file=/etc/asterisk/keys/fullchain.pem
priv_key_file=/etc/asterisk/keys/privkey.pem
method=tlsv1_2
; AWS Chime requires TLS 1.2+

; =============================================================================
; AWS Chime Voice Connector Endpoint
; =============================================================================

[aws-chime]
type=endpoint
context=from-chime
transport=transport-tls
disallow=all
allow=ulaw
; AWS Chime uses G.711 Î¼-law
direct_media=no
; Force media through Asterisk for our shim server
ice_support=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes
aors=aws-chime

[aws-chime]
type=aor
contact=sip:your-voice-connector-id.voiceconnector.chime.aws

[aws-chime]
type=identify
endpoint=aws-chime
match=99.77.253.0/24
; AWS Chime CIDR ranges (update via Lambda for dynamic IPs)

; =============================================================================
; External Media for Voice Agent Bridge
; =============================================================================

[external-media]
type=endpoint
context=external-media
transport=transport-tls
disallow=all
allow=ulaw
direct_media=no
; Used for ExternalMedia channels that bridge to our shim server

; =============================================================================
; Local Extensions (for testing)
; =============================================================================

[local-agent]
type=endpoint
context=internal
transport=transport-tls
disallow=all
allow=ulaw
direct_media=no
aors=local-agent
auth=local-agent

[local-agent]
type=aor
max_contacts=5

[local-agent]
type=auth
auth_type=userpass
username=agent
password=secure-test-password
